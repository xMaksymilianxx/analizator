<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Profesjonalna Analiza Zak≈Çad√≥w Sportowych üìä</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--light-color);
            border-radius: 8px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .analysis-section {
            margin-top: 30px;
            display: none;
        }

        .analysis-card {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .stats-table th {
            background-color: var(--light-color);
            font-weight: bold;
        }

        .stats-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .risk-indicator {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
        }

        .risk-low {
            background-color: var(--success-color);
            color: white;
        }

        .risk-medium {
            background-color: var(--warning-color);
            color: black;
        }

        .risk-high {
            background-color: var(--danger-color);
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .error-message {
            color: var(--danger-color);
            padding: 10px;
            border: 1px solid var(--danger-color);
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Profesjonalna Analiza Zak≈Çad√≥w Sportowych</h1>
            <p>System analizy oparty na zaawansowanych algorytmach i danych historycznych</p>
        </div>

        <div class="control-panel">
            <div class="form-group">
                <label for="sportType">üèÜ Wybierz sport:</label>
                <select id="sportType" class="form-control">
                    <option value="">≈Åadowanie sport√≥w...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="leagueType">üåç Typ rozgrywek:</label>
                <select id="leagueType" class="form-control">
                    <option value="all">Wszystkie ligi</option>
                    <option value="niche">Ligi niszowe</option>
                    <option value="popular">Popularne ligi</option>
                </select>
            </div>

            <div class="form-group">
                <label for="analysisDate">üìÖ Data analizy:</label>
                <input type="date" id="analysisDate" class="form-control">
            </div>

            <div class="form-group">
                <label for="stakeAmount">üí∞ Stawka (PLN):</label>
                <input type="number" id="stakeAmount" class="form-control" min="1" value="100">
            </div>
        </div>

        <button onclick="performCompleteAnalysis()" class="btn btn-primary">
            üîç Przeprowad≈∫ pe≈ÇnƒÖ analizƒô
        </button>

        <div id="loading" class="loading">
            <h3>‚åõ Trwa analiza danych...</h3>
        </div>

        <div id="errorMessage" class="error-message"></div>

        <div id="analysisResults" class="analysis-section">
            <div class="analysis-card">
                <h2>üìä Analiza Handicap√≥w</h2>
                <div id="handicapResults"></div>
            </div>

            <div class="analysis-card">
                <h2>üåü Analiza Lig Niszowych</h2>
                <div id="nicheResults"></div>
            </div>

            <div class="analysis-card">
                <h2>üìà Statystyki i Przewidywania</h2>
                <div id="statsResults"></div>
            </div>
        </div>
    </div>
    <script>
        const API_KEY = '631900acd2063f2fa684e2257dfa5588';
        
        // Inicjalizacja przy za≈Çadowaniu strony
        document.addEventListener('DOMContentLoaded', async () => {
            await loadSports();
            setDefaultDate();
        });

        // Ustawienie domy≈õlnej daty na dzisiaj
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('analysisDate').value = today;
        }

        // Pobieranie listy sport√≥w
        async function loadSports() {
            try {
                const response = await fetch(`https://api.the-odds-api.com/v4/sports/?apiKey=${API_KEY}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const sports = await response.json();
                
                const sportSelect = document.getElementById('sportType');
                sportSelect.innerHTML = '';
                
                sports.forEach(sport => {
                    if (sport.active) {
                        const option = document.createElement('option');
                        option.value = sport.key;
                        option.textContent = `${sport.title} ${getSportEmoji(sport.group)}`;
                        sportSelect.appendChild(option);
                    }
                });
            } catch (error) {
                showError('B≈ÇƒÖd podczas ≈Çadowania sport√≥w: ' + error.message);
            }
        }

        function getSportEmoji(sportGroup) {
            const emojiMap = {
                'Soccer': '‚öΩ',
                'Basketball': 'üèÄ',
                'American Football': 'üèà',
                'Baseball': '‚öæ',
                'Ice Hockey': 'üèí',
                'Tennis': 'üéæ',
                'MMA': 'ü•ä',
                'Cricket': 'üèè'
            };
            return emojiMap[sportGroup] || 'üéØ';
        }

        async function performCompleteAnalysis() {
            console.log('Starting analysis...');
            const sportType = document.getElementById('sportType').value;
            const date = document.getElementById('analysisDate').value;
            const leagueType = document.getElementById('leagueType').value;
            const stake = document.getElementById('stakeAmount').value;

            console.log('Selected values:', { sportType, date, leagueType, stake });

            if (!sportType || !date || !stake) {
                showError('Proszƒô wype≈Çniƒá wszystkie pola');
                return;
            }

            showLoading(true);
            clearError();

            try {
                console.log('Fetching data...');
                const [oddsData, scoresData, historicalData] = await Promise.all([
                    getOdds(sportType),
                    getScores(sportType),
                    getHistoricalOdds(sportType, date)
                ]);
                
                console.log('Data received:', { oddsData, scoresData, historicalData });

                const analysis = analyzeData(oddsData, scoresData, historicalData, leagueType, stake);
                console.log('Analysis complete:', analysis);
                
                displayResults(analysis);
            } catch (error) {
                console.error('Analysis error:', error);
                showError('B≈ÇƒÖd podczas analizy: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function getOdds(sport) {
            try {
                const response = await fetch(
                    `https://api.the-odds-api.com/v4/sports/${sport}/odds/?apiKey=${API_KEY}&regions=eu&markets=h2h,spreads`
                );
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('Odds data:', data);
                return data;
            } catch (error) {
                console.error('Error fetching odds:', error);
                throw error;
            }
        }

        async function getScores(sport) {
            const response = await fetch(
                `https://api.the-odds-api.com/v4/sports/${sport}/scores/?apiKey=${API_KEY}`
            );
            return await response.json();
        }

        async function getHistoricalOdds(sport, date) {
            const response = await fetch(
                `https://api.the-odds-api.com/v4/sports/${sport}/odds-history/?apiKey=${API_KEY}&date=${date}`
            );
            return await response.json();
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function clearError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function analyzeData(oddsData, scoresData, historicalData, leagueType, stake) {
            const analysis = {
                handicaps: analyzeHandicaps(oddsData),
                nicheLeagues: analyzeNicheLeagues(oddsData, leagueType),
                statistics: calculateStatistics(oddsData, historicalData, stake)
            };
            return analysis;
        }

        function analyzeHandicaps(oddsData) {
            return oddsData.map(match => ({
                match: `${match.home_team} vs ${match.away_team}`,
                handicap: calculateHandicap(match),
                odds: getOptimalOdds(match),
                recommendation: generateRecommendation(match)
            }));
        }

        function calculateHandicap(match) {
            return match.markets?.find(m => m.key === 'spreads')?.outcomes[0]?.point || 'N/A';
        }

        function getOptimalOdds(match) {
            return match.markets?.find(m => m.key === 'h2h')?.outcomes[0]?.price || 'N/A';
        }

        function generateRecommendation(match) {
            return 'Analiza w toku';
        }

        function analyzeNicheLeagues(oddsData, leagueType) {
            const leagues = groupByLeague(oddsData);
            return Object.entries(leagues).map(([league, matches]) => ({
                name: league,
                matches: matches.length,
                averageOdds: calculateAverageOdds(matches),
                risk: calculateRiskLevel(matches),
                potential: calculatePotentialProfit(matches)
            }));
        }

        function groupByLeague(oddsData) {
            return oddsData.reduce((acc, match) => {
                const league = match.sport_title || 'Unknown';
                if (!acc[league]) acc[league] = [];
                acc[league].push(match);
                return acc;
            }, {});
        }

        function calculateAverageOdds(matches) {
            if (!matches.length) return 0;
            const odds = matches.map(m => getOptimalOdds(m)).filter(o => o !== 'N/A');
            return odds.length ? odds.reduce((a, b) => a + b, 0) / odds.length : 0;
        }

        function calculateRiskLevel(matches) {
            const avgOdds = calculateAverageOdds(matches);
            if (avgOdds > 2.5) return 'High';
            if (avgOdds > 1.8) return 'Medium';
            return 'Low';
        }

        function calculatePotentialProfit(matches) {
            return Math.round((calculateAverageOdds(matches) - 1) * 100);
        }

        function calculateStatistics(oddsData, historicalData, stake) {
            return {
                totalMatches: oddsData.length,
                averageOdds: calculateAverageOdds(oddsData),
                potentialProfit: calculatePotentialProfit(oddsData),
                riskDistribution: calculateRiskDistribution(oddsData)
            };
        }

        function calculateRiskDistribution(oddsData) {
            return {
                low: 0,
                medium: 0,
                high: 0
            };
        }

        function displayResults(analysis) {
            document.getElementById('analysisResults').style.display = 'block';
            displayHandicaps(analysis.handicaps);
            displayNicheLeagues(analysis.nicheLeagues);
            displayStatistics(analysis.statistics);
        }

        function displayHandicaps(handicaps) {
            const handicapResults = document.getElementById('handicapResults');
            handicapResults.innerHTML = `
                <table class="stats-table">
                    <tr>
                        <th>Mecz</th>
                        <th>Handicap</th>
                        <th>Kurs</th>
                        <th>Rekomendacja</th>
                    </tr>
                    ${handicaps.map(h => `
                        <tr>
                            <td>${h.match}</td>
                            <td>${h.handicap}</td>
                            <td>${h.odds}</td>
                            <td>${h.recommendation}</td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }

        function displayNicheLeagues(leagues) {
            const nicheResults = document.getElementById('nicheResults');
            nicheResults.innerHTML = `
                <table class="stats-table">
                    <tr>
                        <th>Liga</th>
                        <th>Liczba mecz√≥w</th>
                        <th>≈öredni kurs</th>
                        <th>Poziom ryzyka</th>
                        <th>Potencjalny zysk</th>
                    </tr>
                    ${leagues.map(l => `
                        <tr>
                            <td>${l.name}</td>
                            <td>${l.matches}</td>
                            <td>${l.averageOdds.toFixed(2)}</td>
                            <td><span class="risk-indicator risk-${l.risk.toLowerCase()}">${l.risk}</span></td>
                            <td>${l.potential}%</td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }

        function displayStatistics(stats) {
            const statsResults = document.getElementById('statsResults');
            statsResults.innerHTML = `
                <div class="stats-summary">
                    <table class="stats-table">
                        <tr>
                            <th>Ca≈Çkowita liczba mecz√≥w</th>
                            <td>${stats.totalMatches}</td>
                        </tr>
                        <tr>
                            <th>≈öredni kurs</th>
                            <td>${stats.averageOdds?.toFixed(2) || 'N/A'}</td>
                        </tr>
                        <tr>
                            <th>Potencjalny zysk</th>
                            <td>${stats.potentialProfit}%</td>
                        </tr>
                    </table>
                </div>
            `;
        }
    </script>
</body>
</html>